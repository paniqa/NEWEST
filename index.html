<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Альтушка Ника</title>
    <style>
        :root {
            --primary-color: #ff6b9e;
            --secondary-color: #9d4edd;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --success-color: #4cc9f0;
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .currency {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .currency-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
        }

        .currency-icon {
            width: 20px;
            height: 20px;
        }

        .love-meter {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .love-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .love-hearts {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 10px;
            box-shadow: var(--shadow);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
            color: var(--text-color);
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .character-card {
            text-align: center;
        }

        .character-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            border: 5px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .character-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .character-description {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .shop-item {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .shop-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .item-image {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }

        .item-description {
            font-size: 14px;
            margin-bottom: 8px;
            color: #666;
        }

        .item-price {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .buy-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .buy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .achievements {
            margin-top: 20px;
        }

        .achievement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .achievement-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-description {
            font-size: 12px;
            color: #666;
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        .auth-panel {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .auth-btn {
            background: linear-gradient(45deg, #4285F4, #34A853);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin: 5px;
        }

        @media (max-width: 480px) {
            .header {
                flex-direction: column;
                gap: 10px;
            }
            
            .character-image {
                width: 150px;
                height: 150px;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Альтушка Ника</h1>
            <div class="currency">
                <div class="currency-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="Гемы" class="currency-icon">
                    <span id="gems">0</span>
                </div>
                <div class="currency-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/1828/1828915.png" alt="Запросы" class="currency-icon">
                    <span id="requests">0</span>
                </div>
            </div>
        </div>

        <div id="authPanel" class="auth-panel">
            <h3>Войдите, чтобы играть</h3>
            <button id="anonAuth" class="auth-btn">Играть как гость</button>
        </div>

        <div id="gameContent" style="display: none;">
            <div class="love-meter">
                <div class="love-fill" id="loveFill"></div>
                <div class="love-hearts" id="loveHearts">Уровень влюбленности: 0%</div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="character">Персонаж</div>
                <div class="tab" data-tab="shop">Товары</div>
                <div class="tab" data-tab="profile">Профиль</div>
            </div>

            <div class="tab-content active" id="character">
                <div class="card character-card">
                    <img src="https://i.pinimg.com/736x/2b/5b/0b/2b5b0b3a3a3a3a3a3a3a3a3a3a3a3a3a.jpg" alt="Ника" class="character-image">
                    <h2 class="character-name">Ника</h2>
                    <p class="character-description">
                        Романтичная и стеснительная девушка с нежным характером. Ника обожает тихие вечера с хорошей книгой и чашкой чая. 
                        Она немного замкнута в себе, но если найти к ней подход, открывается как цветок, показывая свою теплую и заботливую натуру.
                        Её сердце - как хрустальный сосуд, который нужно наполнять любовью и вниманием, но очень осторожно, чтобы не разбить.
                    </p>
                    <div class="love-meter">
                        <div class="love-fill" id="characterLoveFill"></div>
                        <div class="love-hearts">Уровень влюбленности: <span id="characterLovePercent">0</span>%</div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="shop">
                <div class="card">
                    <h2>Магазин подарков</h2>
                    <p>Выберите подарок для Ники, чтобы увеличить её уровень влюбленности</p>
                    
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3050/3050159.png" alt="Бутылка вина" class="item-image">
                        <div class="item-info">
                            <h3 class="item-name">Бутылка вина</h3>
                            <p class="item-description">Ника раскрепощается и желает больше общения, повышается влюбленность и откровенность.</p>
                            <div class="item-price">
                                <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="Гемы" class="currency-icon">
                                <span>290</span>
                            </div>
                        </div>
                        <button class="buy-btn" data-item="wine" data-cost="290" data-love="20" data-requests="100">Купить</button>
                    </div>
                    
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/2583/2583344.png" alt="Букет цветов" class="item-image">
                        <div class="item-info">
                            <h3 class="item-name">Букет цветов</h3>
                            <p class="item-description">990 черных роз заставят её проникнуться чувствами и желанием к вам.</p>
                            <div class="item-price">
                                <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="Гемы" class="currency-icon">
                                <span>490</span>
                            </div>
                        </div>
                        <button class="buy-btn" data-item="flowers" data-cost="490" data-love="35" data-requests="0">Купить</button>
                    </div>
                    
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3081/3081989.png" alt="Кожанная Мечта" class="item-image">
                        <div class="item-info">
                            <h3 class="item-name">Кожанная Мечта</h3>
                            <p class="item-description">Кастомная кожанка редчайшего бренда, она будет неимоверно рада и счастлива, наслаждайтесь общением вместе по максимуму!</p>
                            <div class="item-price">
                                <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="Гемы" class="currency-icon">
                                <span>1190</span>
                            </div>
                        </div>
                        <button class="buy-btn" data-item="jacket" data-cost="1190" data-love="50" data-requests="200">Купить</button>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="profile">
                <div class="card">
                    <h2>Ваш профиль</h2>
                    
                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="statDays">1</div>
                            <div class="stat-label">Дней с Никой</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statGifts">0</div>
                            <div class="stat-label">Подарков вручено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statLove">0</div>
                            <div class="stat-label">Уровень влюбленности</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statSpent">0</div>
                            <div class="stat-label">Гемов потрачено</div>
                        </div>
                    </div>
                    
                    <div class="achievements">
                        <h3>Достижения</h3>
                        
                        <div class="achievement">
                            <div class="achievement-icon">🥂</div>
                            <div class="achievement-info">
                                <div class="achievement-name">Первое свидание</div>
                                <div class="achievement-description">Подарите Нике первый подарок</div>
                            </div>
                            <div class="achievement-status" id="achFirstGift">🔒</div>
                        </div>
                        
                        <div class="achievement">
                            <div class="achievement-icon">💘</div>
                            <div class="achievement-info">
                                <div class="achievement-name">Влюбленность</div>
                                <div class="achievement-description">Достигните 50% уровня влюбленности</div>
                            </div>
                            <div class="achievement-status" id="achHalfLove">🔒</div>
                        </div>
                        
                        <div class="achievement">
                            <div class="achievement-icon">💍</div>
                            <div class="achievement-info">
                                <div class="achievement-name">Сердце Ники</div>
                                <div class="achievement-description">Достигните 100% уровня влюбленности</div>
                            </div>
                            <div class="achievement-status" id="achFullLove">🔒</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        // Конфигурация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA2pbT4iiVJj13Wa-0yW77TsjPlrzfZJjk",
            authDomain: "tgtest-ff1d2.firebaseapp.com",
            databaseURL: "https://tgtest-ff1d2-default-rtdb.firebaseio.com",
            projectId: "tgtest-ff1d2",
            storageBucket: "tgtest-ff1d2.firebasestorage.app",
            messagingSenderId: "571481427242",
            appId: "1:571481427242:web:51cf2a2e4059085be6a253"
        };

        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Игровые данные
        let gameData = {
            love: 0,
            gems: 50000,
            requests: 100,
            giftsGiven: 0,
            gemsSpent: 0,
            daysWithNika: 1,
            achievements: {
                firstGift: false,
                halfLove: false,
                fullLove: false
            }
        };

        // Элементы интерфейса
        const elements = {
            authPanel: document.getElementById('authPanel'),
            gameContent: document.getElementById('gameContent'),
            anonAuth: document.getElementById('anonAuth'),
            loveFill: document.getElementById('loveFill'),
            loveHearts: document.getElementById('loveHearts'),
            characterLoveFill: document.getElementById('characterLoveFill'),
            characterLovePercent: document.getElementById('characterLovePercent'),
            gems: document.getElementById('gems'),
            requests: document.getElementById('requests'),
            statDays: document.getElementById('statDays'),
            statGifts: document.getElementById('statGifts'),
            statLove: document.getElementById('statLove'),
            statSpent: document.getElementById('statSpent'),
            achFirstGift: document.getElementById('achFirstGift'),
            achHalfLove: document.getElementById('achHalfLove'),
            achFullLove: document.getElementById('achFullLove'),
            toast: document.getElementById('toast'),
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            buyButtons: document.querySelectorAll('.buy-btn')
        };

        // Инициализация игры
        function initGame() {
            updateUI();
            setupEventListeners();
            startDayCounter();
            
            // Показываем игровой контент
            elements.authPanel.style.display = 'none';
            elements.gameContent.style.display = 'block';
        }

        // Обновление интерфейса
        function updateUI() {
            const lovePercent = Math.min(100, Math.max(0, gameData.love));
            elements.loveFill.style.width = `${lovePercent}%`;
            elements.characterLoveFill.style.width = `${lovePercent}%`;
            elements.loveHearts.textContent = `Уровень влюбленности: ${lovePercent}%`;
            elements.characterLovePercent.textContent = lovePercent;
            elements.statLove.textContent = lovePercent;
            
            elements.gems.textContent = gameData.gems;
            elements.requests.textContent = gameData.requests;
            
            elements.statDays.textContent = gameData.daysWithNika;
            elements.statGifts.textContent = gameData.giftsGiven;
            elements.statSpent.textContent = gameData.gemsSpent;
            
            elements.buyButtons.forEach(button => {
                const cost = parseInt(button.getAttribute('data-cost'));
                button.disabled = gameData.gems < cost;
            });
            
            checkAchievements();
        }

        // Проверка достижений
        function checkAchievements() {
            if (gameData.giftsGiven > 0 && !gameData.achievements.firstGift) {
                gameData.achievements.firstGift = true;
                elements.achFirstGift.textContent = '✅';
                showToast('Достижение разблокировано: Первое свидание!');
                saveGameData();
            }
            
            if (gameData.love >= 50 && !gameData.achievements.halfLove) {
                gameData.achievements.halfLove = true;
                elements.achHalfLove.textContent = '✅';
                showToast('Достижение разблокировано: Влюбленность!');
                saveGameData();
            }
            
            if (gameData.love >= 100 && !gameData.achievements.fullLove) {
                gameData.achievements.fullLove = true;
                elements.achFullLove.textContent = '✅';
                showToast('Достижение разблокировано: Сердце Ники!');
                saveGameData();
            }
        }

        // Сохранение данных игры
        function saveGameData() {
            const user = auth.currentUser;
            if (user) {
                db.ref(`users/${user.uid}`).set(gameData)
                    .catch(error => {
                        console.error("Ошибка сохранения:", error);
                        showToast("Ошибка сохранения данных");
                    });
            }
        }

        // Загрузка данных игры
        function loadGameData() {
            const user = auth.currentUser;
            if (user) {
                db.ref(`users/${user.uid}`).once('value')
                    .then(snapshot => {
                        const data = snapshot.val();
                        if (data) {
                            gameData = data;
                            updateUI();
                            showToast("Данные загружены");
                        } else {
                            // Новый пользователь - сохраняем начальные данные
                            saveGameData();
                        }
                    })
                    .catch(error => {
                        console.error("Ошибка загрузки:", error);
                        showToast("Ошибка загрузки данных");
                    });
            }
        }

        // Покупка товара
        function buyItem(item) {
            const button = item.target;
            const cost = parseInt(button.getAttribute('data-cost'));
            const love = parseInt(button.getAttribute('data-love'));
            const requests = parseInt(button.getAttribute('data-requests'));
            const itemName = button.getAttribute('data-item');
            
            if (gameData.gems >= cost) {
                gameData.gems -= cost;
                gameData.love += love;
                gameData.requests += requests;
                gameData.giftsGiven++;
                gameData.gemsSpent += cost;
                
                if (gameData.love > 100) {
                    gameData.love = 100;
                }
                
                updateUI();
                saveGameData();
                
                let message = `Вы подарили Нике ${getItemName(itemName)}!`;
                if (love > 0) message += ` Уровень влюбленности +${love}!`;
                if (requests > 0) message += ` +${requests} запросов!`;
                
                showToast(message);
            } else {
                showToast('Недостаточно гемов!');
            }
        }

        // Получение названия товара
        function getItemName(itemId) {
            switch(itemId) {
                case 'wine': return 'Бутылку вина';
                case 'flowers': return 'Букет цветов';
                case 'jacket': return 'Кожаную Мечту';
                default: return 'подарок';
            }
        }

        // Показ уведомления
        function showToast(message) {
            elements.toast.textContent = message;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }

        // Переключение вкладок
        function switchTab(event) {
            const tabId = event.target.getAttribute('data-tab');
            
            elements.tabs.forEach(tab => tab.classList.remove('active'));
            elements.tabContents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Счетчик дней с Никой
        function startDayCounter() {
            setInterval(() => {
                gameData.daysWithNika++;
                elements.statDays.textContent = gameData.daysWithNika;
                
                if (gameData.love < 100) {
                    gameData.love = Math.min(100, gameData.love + 1);
                    updateUI();
                    saveGameData();
                }
            }, 60000); // 1 минута для демонстрации
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', switchTab);
            });
            
            elements.buyButtons.forEach(button => {
                button.addEventListener('click', buyItem);
            });
            
            // Аутентификация анонимно
            elements.anonAuth.addEventListener('click', () => {
                auth.signInAnonymously()
                    .then(() => {
                        loadGameData();
                        initGame();
                    })
                    .catch(error => {
                        console.error("Ошибка аутентификации:", error);
                        showToast("Ошибка входа");
                    });
            });
        }

        // Автоматическая загрузка при аутентификации
        auth.onAuthStateChanged(user => {
            if (user) {
                loadGameData();
                initGame();
            }
        });

        // Проверка аутентификации при загрузке
        if (auth.currentUser) {
            initGame();
        }
    </script>
</body>
</html>
