<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–ª—å—Ç—É—à–∫–∞ –ù–∏–∫–∞</title>
    <style>
        :root {
            --primary-color: #ff6b9e;
            --secondary-color: #9d4edd;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --success-color: #4cc9f0;
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .currency {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .currency-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
        }

        .currency-icon {
            width: 20px;
            height: 20px;
        }

        .love-meter {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .love-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .love-hearts {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 10px;
            box-shadow: var(--shadow);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
            color: var(--text-color);
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .character-card {
            text-align: center;
        }

        .character-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            border: 5px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .character-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .character-description {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .shop-item {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .shop-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .item-image {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }

        .item-description {
            font-size: 14px;
            margin-bottom: 8px;
            color: #666;
        }

        .item-price {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .buy-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .buy-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .achievements {
            margin-top: 20px;
        }

        .achievement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .achievement-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-description {
            font-size: 12px;
            color: #666;
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        .auth-panel {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .auth-btn {
            background: linear-gradient(45deg, #4285F4, #34A853);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin: 5px;
        }

        @media (max-width: 480px) {
            .header {
                flex-direction: column;
                gap: 10px;
            }
            
            .character-image {
                width: 150px;
                height: 150px;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ê–ª—å—Ç—É—à–∫–∞ –ù–∏–∫–∞</h1>
            <div class="currency">
                <div class="currency-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="–ì–µ–º—ã" class="currency-icon">
                    <span id="gems">0</span>
                </div>
                <div class="currency-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/1828/1828915.png" alt="–ó–∞–ø—Ä–æ—Å—ã" class="currency-icon">
                    <span id="requests">0</span>
                </div>
            </div>
        </div>

        <div id="authPanel" class="auth-panel">
            <h3>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å</h3>
            <button id="anonAuth" class="auth-btn">–ò–≥—Ä–∞—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å</button>
        </div>

        <div id="gameContent" style="display: none;">
            <div class="love-meter">
                <div class="love-fill" id="loveFill"></div>
                <div class="love-hearts" id="loveHearts">–£—Ä–æ–≤–µ–Ω—å –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏: 0%</div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</div>
                <div class="tab" data-tab="shop">–¢–æ–≤–∞—Ä—ã</div>
                <div class="tab" data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</div>
            </div>

            <div class="tab-content active" id="character">
                <div class="card character-card">
                    <img src="https://i.pinimg.com/736x/2b/5b/0b/2b5b0b3a3a3a3a3a3a3a3a3a3a3a3a3a.jpg" alt="–ù–∏–∫–∞" class="character-image">
                    <h2 class="character-name">–ù–∏–∫–∞</h2>
                    <p class="character-description">
                        –†–æ–º–∞–Ω—Ç–∏—á–Ω–∞—è –∏ —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞ —Å –Ω–µ–∂–Ω—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º. –ù–∏–∫–∞ –æ–±–æ–∂–∞–µ—Ç —Ç–∏—Ö–∏–µ –≤–µ—á–µ—Ä–∞ —Å —Ö–æ—Ä–æ—à–µ–π –∫–Ω–∏–≥–æ–π –∏ —á–∞—à–∫–æ–π —á–∞—è. 
                        –û–Ω–∞ –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–∫–Ω—É—Ç–∞ –≤ —Å–µ–±–µ, –Ω–æ –µ—Å–ª–∏ –Ω–∞–π—Ç–∏ –∫ –Ω–µ–π –ø–æ–¥—Ö–æ–¥, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Ü–≤–µ—Ç–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞—è —Å–≤–æ—é —Ç–µ–ø–ª—É—é –∏ –∑–∞–±–æ—Ç–ª–∏–≤—É—é –Ω–∞—Ç—É—Ä—É.
                        –ï—ë —Å–µ—Ä–¥—Ü–µ - –∫–∞–∫ —Ö—Ä—É—Å—Ç–∞–ª—å–Ω—ã–π —Å–æ—Å—É–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –Ω–∞–ø–æ–ª–Ω—è—Ç—å –ª—é–±–æ–≤—å—é –∏ –≤–Ω–∏–º–∞–Ω–∏–µ–º, –Ω–æ –æ—á–µ–Ω—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–±–∏—Ç—å.
                    </p>
                    <div class="love-meter">
                        <div class="love-fill" id="characterLoveFill"></div>
                        <div class="love-hearts">–£—Ä–æ–≤–µ–Ω—å –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏: <span id="characterLovePercent">0</span>%</div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="shop">
                <div class="card">
                    <h2>–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è –ù–∏–∫–∏, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –µ—ë —É—Ä–æ–≤–µ–Ω—å –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏</p>
                    
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3050/3050159.png" alt="–ë—É—Ç—ã–ª–∫–∞ –≤–∏–Ω–∞" class="item-image">
                        <div class="item-info">
                            <h3 class="item-name">–ë—É—Ç—ã–ª–∫–∞ –≤–∏–Ω–∞</h3>
                            <p class="item-description">–ù–∏–∫–∞ —Ä–∞—Å–∫—Ä–µ–ø–æ—â–∞–µ—Ç—Å—è –∏ –∂–µ–ª–∞–µ—Ç –±–æ–ª—å—à–µ –æ–±—â–µ–Ω–∏—è, –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ—Å—Ç—å.</p>
                            <div class="item-price">
                                <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="–ì–µ–º—ã" class="currency-icon">
                                <span>290</span>
                            </div>
                        </div>
                        <button class="buy-btn" data-item="wine" data-cost="290" data-love="20" data-requests="100">–ö—É–ø–∏—Ç—å</button>
                    </div>
                    
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/2583/2583344.png" alt="–ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤" class="item-image">
                        <div class="item-info">
                            <h3 class="item-name">–ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤</h3>
                            <p class="item-description">990 —á–µ—Ä–Ω—ã—Ö —Ä–æ–∑ –∑–∞—Å—Ç–∞–≤—è—Ç –µ—ë –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç—å—Å—è —á—É–≤—Å—Ç–≤–∞–º–∏ –∏ –∂–µ–ª–∞–Ω–∏–µ–º –∫ –≤–∞–º.</p>
                            <div class="item-price">
                                <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="–ì–µ–º—ã" class="currency-icon">
                                <span>490</span>
                            </div>
                        </div>
                        <button class="buy-btn" data-item="flowers" data-cost="490" data-love="35" data-requests="0">–ö—É–ø–∏—Ç—å</button>
                    </div>
                    
                    <div class="shop-item">
                        <img src="https://cdn-icons-png.flaticon.com/512/3081/3081989.png" alt="–ö–æ–∂–∞–Ω–Ω–∞—è –ú–µ—á—Ç–∞" class="item-image">
                        <div class="item-info">
                            <h3 class="item-name">–ö–æ–∂–∞–Ω–Ω–∞—è –ú–µ—á—Ç–∞</h3>
                            <p class="item-description">–ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–∂–∞–Ω–∫–∞ —Ä–µ–¥—á–∞–π—à–µ–≥–æ –±—Ä–µ–Ω–¥–∞, –æ–Ω–∞ –±—É–¥–µ—Ç –Ω–µ–∏–º–æ–≤–µ—Ä–Ω–æ —Ä–∞–¥–∞ –∏ —Å—á–∞—Å—Ç–ª–∏–≤–∞, –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –æ–±—â–µ–Ω–∏–µ–º –≤–º–µ—Å—Ç–µ –ø–æ –º–∞–∫—Å–∏–º—É–º—É!</p>
                            <div class="item-price">
                                <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png" alt="–ì–µ–º—ã" class="currency-icon">
                                <span>1190</span>
                            </div>
                        </div>
                        <button class="buy-btn" data-item="jacket" data-cost="1190" data-love="50" data-requests="200">–ö—É–ø–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="profile">
                <div class="card">
                    <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
                    
                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="statDays">1</div>
                            <div class="stat-label">–î–Ω–µ–π —Å –ù–∏–∫–æ–π</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statGifts">0</div>
                            <div class="stat-label">–ü–æ–¥–∞—Ä–∫–æ–≤ –≤—Ä—É—á–µ–Ω–æ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statLove">0</div>
                            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statSpent">0</div>
                            <div class="stat-label">–ì–µ–º–æ–≤ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
                        </div>
                    </div>
                    
                    <div class="achievements">
                        <h3>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                        
                        <div class="achievement">
                            <div class="achievement-icon">ü•Ç</div>
                            <div class="achievement-info">
                                <div class="achievement-name">–ü–µ—Ä–≤–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ</div>
                                <div class="achievement-description">–ü–æ–¥–∞—Ä–∏—Ç–µ –ù–∏–∫–µ –ø–µ—Ä–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫</div>
                            </div>
                            <div class="achievement-status" id="achFirstGift">üîí</div>
                        </div>
                        
                        <div class="achievement">
                            <div class="achievement-icon">üíò</div>
                            <div class="achievement-info">
                                <div class="achievement-name">–í–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç—å</div>
                                <div class="achievement-description">–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 50% —É—Ä–æ–≤–Ω—è –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏</div>
                            </div>
                            <div class="achievement-status" id="achHalfLove">üîí</div>
                        </div>
                        
                        <div class="achievement">
                            <div class="achievement-icon">üíç</div>
                            <div class="achievement-info">
                                <div class="achievement-name">–°–µ—Ä–¥—Ü–µ –ù–∏–∫–∏</div>
                                <div class="achievement-description">–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 100% —É—Ä–æ–≤–Ω—è –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏</div>
                            </div>
                            <div class="achievement-status" id="achFullLove">üîí</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA2pbT4iiVJj13Wa-0yW77TsjPlrzfZJjk",
            authDomain: "tgtest-ff1d2.firebaseapp.com",
            databaseURL: "https://tgtest-ff1d2-default-rtdb.firebaseio.com",
            projectId: "tgtest-ff1d2",
            storageBucket: "tgtest-ff1d2.firebasestorage.app",
            messagingSenderId: "571481427242",
            appId: "1:571481427242:web:51cf2a2e4059085be6a253"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            love: 0,
            gems: 50000,
            requests: 100,
            giftsGiven: 0,
            gemsSpent: 0,
            daysWithNika: 1,
            achievements: {
                firstGift: false,
                halfLove: false,
                fullLove: false
            }
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const elements = {
            authPanel: document.getElementById('authPanel'),
            gameContent: document.getElementById('gameContent'),
            anonAuth: document.getElementById('anonAuth'),
            loveFill: document.getElementById('loveFill'),
            loveHearts: document.getElementById('loveHearts'),
            characterLoveFill: document.getElementById('characterLoveFill'),
            characterLovePercent: document.getElementById('characterLovePercent'),
            gems: document.getElementById('gems'),
            requests: document.getElementById('requests'),
            statDays: document.getElementById('statDays'),
            statGifts: document.getElementById('statGifts'),
            statLove: document.getElementById('statLove'),
            statSpent: document.getElementById('statSpent'),
            achFirstGift: document.getElementById('achFirstGift'),
            achHalfLove: document.getElementById('achHalfLove'),
            achFullLove: document.getElementById('achFullLove'),
            toast: document.getElementById('toast'),
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            buyButtons: document.querySelectorAll('.buy-btn')
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            updateUI();
            setupEventListeners();
            startDayCounter();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
            elements.authPanel.style.display = 'none';
            elements.gameContent.style.display = 'block';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            const lovePercent = Math.min(100, Math.max(0, gameData.love));
            elements.loveFill.style.width = `${lovePercent}%`;
            elements.characterLoveFill.style.width = `${lovePercent}%`;
            elements.loveHearts.textContent = `–£—Ä–æ–≤–µ–Ω—å –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏: ${lovePercent}%`;
            elements.characterLovePercent.textContent = lovePercent;
            elements.statLove.textContent = lovePercent;
            
            elements.gems.textContent = gameData.gems;
            elements.requests.textContent = gameData.requests;
            
            elements.statDays.textContent = gameData.daysWithNika;
            elements.statGifts.textContent = gameData.giftsGiven;
            elements.statSpent.textContent = gameData.gemsSpent;
            
            elements.buyButtons.forEach(button => {
                const cost = parseInt(button.getAttribute('data-cost'));
                button.disabled = gameData.gems < cost;
            });
            
            checkAchievements();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function checkAchievements() {
            if (gameData.giftsGiven > 0 && !gameData.achievements.firstGift) {
                gameData.achievements.firstGift = true;
                elements.achFirstGift.textContent = '‚úÖ';
                showToast('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –ü–µ—Ä–≤–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ!');
                saveGameData();
            }
            
            if (gameData.love >= 50 && !gameData.achievements.halfLove) {
                gameData.achievements.halfLove = true;
                elements.achHalfLove.textContent = '‚úÖ';
                showToast('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –í–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç—å!');
                saveGameData();
            }
            
            if (gameData.love >= 100 && !gameData.achievements.fullLove) {
                gameData.achievements.fullLove = true;
                elements.achFullLove.textContent = '‚úÖ';
                showToast('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –°–µ—Ä–¥—Ü–µ –ù–∏–∫–∏!');
                saveGameData();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
        function saveGameData() {
            const user = auth.currentUser;
            if (user) {
                db.ref(`users/${user.uid}`).set(gameData)
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
                        showToast("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö");
                    });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
        function loadGameData() {
            const user = auth.currentUser;
            if (user) {
                db.ref(`users/${user.uid}`).once('value')
                    .then(snapshot => {
                        const data = snapshot.val();
                        if (data) {
                            gameData = data;
                            updateUI();
                            showToast("–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
                        } else {
                            // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                            saveGameData();
                        }
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
                        showToast("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
                    });
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–∞
        function buyItem(item) {
            const button = item.target;
            const cost = parseInt(button.getAttribute('data-cost'));
            const love = parseInt(button.getAttribute('data-love'));
            const requests = parseInt(button.getAttribute('data-requests'));
            const itemName = button.getAttribute('data-item');
            
            if (gameData.gems >= cost) {
                gameData.gems -= cost;
                gameData.love += love;
                gameData.requests += requests;
                gameData.giftsGiven++;
                gameData.gemsSpent += cost;
                
                if (gameData.love > 100) {
                    gameData.love = 100;
                }
                
                updateUI();
                saveGameData();
                
                let message = `–í—ã –ø–æ–¥–∞—Ä–∏–ª–∏ –ù–∏–∫–µ ${getItemName(itemName)}!`;
                if (love > 0) message += ` –£—Ä–æ–≤–µ–Ω—å –≤–ª—é–±–ª–µ–Ω–Ω–æ—Å—Ç–∏ +${love}!`;
                if (requests > 0) message += ` +${requests} –∑–∞–ø—Ä–æ—Å–æ–≤!`;
                
                showToast(message);
            } else {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–µ–º–æ–≤!');
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        function getItemName(itemId) {
            switch(itemId) {
                case 'wine': return '–ë—É—Ç—ã–ª–∫—É –≤–∏–Ω–∞';
                case 'flowers': return '–ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤';
                case 'jacket': return '–ö–æ–∂–∞–Ω—É—é –ú–µ—á—Ç—É';
                default: return '–ø–æ–¥–∞—Ä–æ–∫';
            }
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showToast(message) {
            elements.toast.textContent = message;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(event) {
            const tabId = event.target.getAttribute('data-tab');
            
            elements.tabs.forEach(tab => tab.classList.remove('active'));
            elements.tabContents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // –°—á–µ—Ç—á–∏–∫ –¥–Ω–µ–π —Å –ù–∏–∫–æ–π
        function startDayCounter() {
            setInterval(() => {
                gameData.daysWithNika++;
                elements.statDays.textContent = gameData.daysWithNika;
                
                if (gameData.love < 100) {
                    gameData.love = Math.min(100, gameData.love + 1);
                    updateUI();
                    saveGameData();
                }
            }, 60000); // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', switchTab);
            });
            
            elements.buyButtons.forEach(button => {
                button.addEventListener('click', buyItem);
            });
            
            // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ
            elements.anonAuth.addEventListener('click', () => {
                auth.signInAnonymously()
                    .then(() => {
                        loadGameData();
                        initGame();
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:", error);
                        showToast("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞");
                    });
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        auth.onAuthStateChanged(user => {
            if (user) {
                loadGameData();
                initGame();
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (auth.currentUser) {
            initGame();
        }
    </script>
</body>
</html>
